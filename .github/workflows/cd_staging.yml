name: Deploy to staging
on:
    push:
        branches: [main]

jobs:
    redeploy_everything:
        runs-on: ubuntu-latest
        name: Deploy everything to staging cluster
        steps:
            - name: Checkout the code
              uses: actions/checkout@v2

            - name: Verify SSH key is set
              run: |
                if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
                  echo "SSH key is not set!"
                  exit 1
                else
                  echo "SSH key is set."
                fi

            - name: executing remote ssh commands using ssh key
              uses: appleboy/ssh-action@v1.2.0
              with:
                host: 139.59.43.39
                username: root
                key: ${{ secrets.SSH_PRIVATE_KEY }}
                port: 22
                script: whoami 